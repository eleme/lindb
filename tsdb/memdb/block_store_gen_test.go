// Generated by tmpl
// https://github.com/benbjohnson/tmpl
//
// DO NOT EDIT!
// Source: block_store_gen_test.go.tmpl

package memdb

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestIntBlockAlloc(t *testing.T) {
	bs := newBlockStore(0)
	assert.NotNil(t, bs)

	// int block
	b1 := bs.allocIntBlock()
	assert.NotNil(t, b1)
	bs.freeBlock(b1)
	b2 := bs.allocIntBlock()
	assert.NotNil(t, b2)
	b3 := bs.allocIntBlock()
	assert.True(t, b1 != b3)
}

func TestIntTimeWindowRange(t *testing.T) {
	bs := newBlockStore(30)

	// int block
	b1 := bs.allocIntBlock()
	assert.True(t, b1.isEmpty())
	b1.setIntValue(10, int64(100))
	assert.True(t, b1.hasValue(10))
	assert.Equal(t, int64(100), b1.getIntValue(10))
	assert.True(t, b1.memsize() > 0)
	assert.Equal(t, uint16(10), b1.getSize())
}

func TestIntReset(t *testing.T) {
	bs := newBlockStore(30)

	// int block
	b1 := bs.allocIntBlock()
	b1.setIntValue(11, int64(100))
	assert.True(t, b1.hasValue(11))
	assert.Equal(t, int64(100), b1.getIntValue(11))
	assert.Equal(t, uint16(11), b1.getSize())
	b1.setIntValue(20, int64(100))
	assert.Equal(t, uint16(20), b1.getSize())
	b1.reset()
	assert.False(t, b1.hasValue(11))
	assert.Equal(t, uint16(0), b1.getSize())
}

func TestFloatBlockAlloc(t *testing.T) {
	bs := newBlockStore(0)
	assert.NotNil(t, bs)

	// float block
	b1 := bs.allocFloatBlock()
	assert.NotNil(t, b1)
	bs.freeBlock(b1)
	b2 := bs.allocFloatBlock()
	assert.NotNil(t, b2)
	b3 := bs.allocFloatBlock()
	assert.True(t, b1 != b3)
}

func TestFloatTimeWindowRange(t *testing.T) {
	bs := newBlockStore(30)

	// float block
	b1 := bs.allocFloatBlock()
	assert.True(t, b1.isEmpty())
	b1.setFloatValue(10, float64(100))
	assert.True(t, b1.hasValue(10))
	assert.Equal(t, float64(100), b1.getFloatValue(10))
	assert.True(t, b1.memsize() > 0)
	assert.Equal(t, uint16(10), b1.getSize())
}

func TestFloatReset(t *testing.T) {
	bs := newBlockStore(30)

	// float block
	b1 := bs.allocFloatBlock()
	b1.setFloatValue(11, float64(100))
	assert.True(t, b1.hasValue(11))
	assert.Equal(t, float64(100), b1.getFloatValue(11))
	assert.Equal(t, uint16(11), b1.getSize())
	b1.setFloatValue(20, float64(100))
	assert.Equal(t, uint16(20), b1.getSize())
	b1.reset()
	assert.False(t, b1.hasValue(11))
	assert.Equal(t, uint16(0), b1.getSize())
}
